"use strict";function AuthenticationService($http,$cookieStore,$rootScope,$timeout,UserService){function Login(username,password,callback){$timeout(function(){var response;UserService.GetByUsername(username).then(function(user){response=null!==user&&user.password===password?{success:!0}:{success:!1,message:"Username or password is incorrect"},callback(response)})},1e3)}function SetCredentials(username,password){var authdata=Base64.encode(username+":"+password);$rootScope.globals={currentUser:{username:username,authdata:authdata}},$http.defaults.headers.common.Authorization="Basic "+authdata,$cookieStore.put("globals",$rootScope.globals)}function ClearCredentials(){$rootScope.globals={},$cookieStore.remove("globals"),$http.defaults.headers.common.Authorization="Basic"}var service={};return service.Login=Login,service.SetCredentials=SetCredentials,service.ClearCredentials=ClearCredentials,service}function Clock(dateFilter,$timeout){return{restrict:"E",scope:{format:"@"},link:function(scope,element,attrs){var updateTime=function(){var now=Date.now();element.html(dateFilter(now,scope.format)),$timeout(updateTime,now%1e3)};updateTime()}}}function LoadCategory($rootScope,$http,$log){function GetAll(){return $http.get(apiUrl+"/api/v1/category").then(handleSuccess,handleError("Error getting all category"))}function handleSuccess(res){return res.data.data}function handleError(error){return function(){return{success:!1,message:error}}}var apiUrl=$rootScope.Url,service={};return service.GetAll=GetAll,service}function DataCache($cacheFactory){return $cacheFactory("dataCache",{})}function OrderProduct($rootScope,$http,$log){function Add(el){createOrUpdate(el),productCalc()}function Delete(i){obj.items.splice(i,1),productCalc()}function GetAll(el){return obj.items}function GetAmount(){return $log.debug("GetAmount:"+summa.amount),summa}function Save(){return $log.debug("OrderProduct --> save"),$log.debug(obj),!0}function Clean(){obj.items.length=0,angular.extend(obj,emptyObj),angular.extend(summa,emptySumma)}function createOrUpdate(el){var isEl=!0;angular.forEach(obj.items,function(val,key){val.code===el.code&&(obj.items[key].amount=val.price*(val.count+1),obj.items[key].count+=1,isEl=!1)}),isEl&&(el.count=1,el.amount=el.price,obj.items.push(el))}function productCalc(){var amount=0;angular.forEach(obj.items,function(val,key){var curAmount=0;curAmount=val.price*val.count,amount+=curAmount,curAmount!=val.amount&&$log.error("curAmount: "+curAmount+" != val.amount: "+val.amount)}),summa.amount=amount,$rootScope.$emit("rootScope.summa"),$log.debug("Set amount:"+summa.amount)}var service=($rootScope.Url,{}),emptyObj={nav:{count:null,page:null,current:null,total:null,next:null,priv:null,isNext:!0,isPriv:!0},items:[],order:"XXX-XXXXXXX",amount:0},obj=emptyObj,emptySumma={amount:0,money:"грн."},summa=emptySumma;return service.Add=Add,service.Delete=Delete,service.GetAll=GetAll,service.GetAmount=GetAmount,service.Save=Save,service.Clean=Clean,service}function LoadProducts($rootScope,$http,$log){var apiUrl=$rootScope.Url,url=null,obj={nav:{count:null,page:null,current:null,total:null,next:null,priv:null,isNext:!0,isPriv:!0},items:[],category:null};return{get:function(category_id,page){return void 0===category_id&&(category_id=0),obj.category=category_id,void 0===page&&(page="?limit=18"),url=obj.category>0?apiUrl+"/api/v1/category/"+obj.category+"/products":apiUrl+"/api/v1/products",0===page.length&&(page="?limit=18"),$http.get(url+page).success(function(data){obj.items=data.data,obj.nav.count=data.count,obj.nav.current=data.current,obj.nav.total=data.total,obj.nav.page=data.current+"/"+data.total,obj.nav.next=data.next,obj.nav.priv=data.priv,data.priv.length>0?obj.nav.isPriv=!1:obj.nav.isPriv=!0,data.next.length>0?obj.nav.isNext=!1:obj.nav.isNext=!0}),obj}}}function UserService($http){function GetAll(){return $http.get("/api/users").then(handleSuccess,handleError("Error getting all users"))}function GetById(id){return $http.get("/api/users/"+id).then(handleSuccess,handleError("Error getting user by id"))}function GetByUsername(username){return $http.get("/api/users/"+username).then(handleSuccess,handleError("Error getting user by username"))}function Create(user){return $http.post("/api/users",user).then(handleSuccess,handleError("Error creating user"))}function Update(user){return $http.put("/api/users/"+user.id,user).then(handleSuccess,handleError("Error updating user"))}function Delete(id){return $http["delete"]("/api/users/"+id).then(handleSuccess,handleError("Error deleting user"))}function handleSuccess(res){return res.data}function handleError(error){return function(){return{success:!1,message:error}}}var service={};return service.GetAll=GetAll,service.GetById=GetById,service.GetByUsername=GetByUsername,service.Create=Create,service.Update=Update,service.Delete=Delete,service}function DemoCtrl($timeout,$q,$log){function newState(state){}function querySearch(query){var deferred,results=query?self.states.filter(createFilterFor(query)):self.states;return self.simulateQuery?(deferred=$q.defer(),$timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise):results}function searchTextChange(text){$log.info("Text changed to "+text)}function selectedItemChange(item){$log.info("Item changed to "+JSON.stringify(item))}function loadAll(){var allStates="Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, Delaware,              Florida, Georgia, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana,              Maine, Maryland, Massachusetts, Michigan, Minnesota, Mississippi, Missouri, Montana,              Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, New York, North Carolina,              North Dakota, Ohio, Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina,              South Dakota, Tennessee, Texas, Utah, Vermont, Virginia, Washington, West Virginia,              Wisconsin, Wyoming";return allStates.split(/, +/g).map(function(state){return{value:state.toLowerCase(),display:state}})}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(state){return 0===state.value.indexOf(lowercaseQuery)}}var self=this;self.simulateQuery=!1,self.isDisabled=!1,self.states=loadAll(),self.querySearch=querySearch,self.selectedItemChange=selectedItemChange,self.searchTextChange=searchTextChange,self.newState=newState}function MainCtrl($rootScope,$log){$rootScope.globalLoader=!0,$rootScope.Url="http://k.bbox.kiev.ua",$rootScope.CurrentCategory=0,$rootScope.user={},$rootScope.user.id=3,$rootScope.user.name="Вейдер Д. А.",$rootScope.OrderCode="XXX-XXXXXXX",$rootScope.products=[],$rootScope.prod=[],$rootScope.orderAmount=0}function KassaAmountCtrl($rootScope,$scope,$element,$log,orderProductFactory){function saveOrder(){var res=orderProductFactory.Save();res&&cleanOrder()}function cleanOrder(){$log.debug("------ cleanOrder -----"),$rootScope.CurrentCategory=0,$rootScope.products.length=0,$rootScope.prod.length=0,$scope.clientAmmount=null,orderProductFactory.Clean(),angular.extend($scope.clientSumma,{amount:0,money:"грн."}),self.clientSurrender=0}function Surrender(){var res=0;return $scope.clientAmmount>0&&(res=$scope.clientAmmount-$scope.clientSumma.amount),$log.info("Surrender="+res),res}var self=this;self.isDisabled=!1,self.clientSurrender=0,self.saveOrder=saveOrder,self.cleanOrder=cleanOrder,$scope.clientAmmount=null,$scope.clientSumma=orderProductFactory.GetAmount(),$scope.$watch("clientAmmount",function(){$log.debug("$watch -------> clientAmmount"),self.clientSurrender=Surrender()}),$rootScope.$on("rootScope.summa",function(){$log.info("KassaAmountCtrl - rootScope.summa"),self.clientSurrender=Surrender()})}function KassaProductCategoryCtrl($rootScope,$scope,$http,$element,$log,loadProductsFactory,orderProductFactory){function goPriv(){$scope.lim=$scope.data.nav.priv,$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)}function goNext(){$scope.lim=$scope.data.nav.next,$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)}function newState(item){orderProductFactory.Add(item)}var self=this;self.isDisabled=!1,$scope.newState=newState,$scope.goPriv=goPriv,$scope.goNext=goNext,$scope.lim="",$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim),$rootScope.$on("rootScope.emit",function(){$log.info("KassaProductCategoryCtrl - rootScope.CurrentCategory"),$scope.lim="",$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)})}function CategoryCtrl($rootScope,$scope,$http,$log,loadCategoryFactory){function newState(id){id!==self.current?($rootScope.CurrentCategory=id,self.current=id):($rootScope.CurrentCategory=0,self.current=0),$rootScope.$emit("rootScope.emit")}var self=this;self.isDisabled=!1,self.newState=newState,self.current=0,self.items=[],loadCategoryFactory.GetAll().then(function(city){self.items=city})}function LoginCtrl($rootScope,$scope,$location,$log){function login(){"1234509876"===self.password&&$location.path("/menu")}var self=this;self.isDisabled=!1,self.login=login,self.password=null}function MenuCtrl($rootScope,$scope,$log,$route,$location){function Go(url){$log.info("MenuCtrl --> Go:"+url+"("+self.name+")"),$location.path(url)}var self=this;self.isDisabled=!1,self.$route=$route,self.Go=Go,self.name=$route.current.name,$scope.$route=$route}function KassaProductCtrl($rootScope,$scope,$http,$element,$log,orderProductFactory){function removeItem(id){orderProductFactory.Delete(id)}var self=this;self.isDisabled=!1,self.removeItem=removeItem,$scope.items=orderProductFactory.GetAll(),self.amount=orderProductFactory.GetAmount()}function KassaSearchCtrl($rootScope,$log){}function ToolbarCtrl($rootScope,$scope,$log,$route,$location){function goExit(){var url="/login";"KassaPage"===self.name&&(url="/menu"),$location.path(url)}var self=this;self.isDisabled=!1,self.isKassa=!1,self.$route=$route,self.goExit=goExit,self.name=$route.current.name,$log.info("Page:"+self.name),"KassaPage"===self.name&&($log.info("set order code show"),self.isKassa=!0)}var app=angular.module("MyApp",["ngMaterial","ngMessages","ngRoute"]);app.config(function($interpolateProvider,$routeProvider,$locationProvider){$interpolateProvider.startSymbol("{[{").endSymbol("}]}"),$routeProvider.when("/",{redirectTo:"/menu"}).when("/login",{name:"LoginPage",templateUrl:"login.html",controller:"LoginCtrl",controllerAs:"ctrl"}).when("/kassa",{name:"KassaPage",templateUrl:"kassa.html"}).when("/menu",{name:"MenuPage",templateUrl:"menu.html",controller:"MenuCtrl",controllerAs:"menu"}).otherwise({redirectTo:"/login"})}),app.controller("MainCtrl",MainCtrl),app.controller("LoginCtrl",LoginCtrl),app.controller("ToolbarCtrl",ToolbarCtrl),app.controller("MenuCtrl",MenuCtrl),app.controller("CategoryCtrl",CategoryCtrl),app.controller("KassaProductCategoryCtrl",KassaProductCategoryCtrl),app.controller("KassaSearchCtrl",KassaSearchCtrl),app.controller("KassaProductCtrl",KassaProductCtrl),app.controller("KassaAmountCtrl",KassaAmountCtrl),app.directive("clock",Clock),app.factory("DataCache",DataCache),app.factory("UserService",UserService),app.factory("AuthenticationService",AuthenticationService),app.factory("loadCategoryFactory",LoadCategory),app.factory("loadProductsFactory",LoadProducts),app.factory("orderProductFactory",OrderProduct),AuthenticationService.$inject=["$http","$cookieStore","$rootScope","$timeout","UserService"];var Base64={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this.keyStr.charAt(enc1)+this.keyStr.charAt(enc2)+this.keyStr.charAt(enc3)+this.keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},decode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0,base64test=/[^A-Za-z0-9\+\/\=]/g;base64test.exec(input),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=this.keyStr.indexOf(input.charAt(i++)),enc2=this.keyStr.indexOf(input.charAt(i++)),enc3=this.keyStr.indexOf(input.charAt(i++)),enc4=this.keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output}};Clock.$inject=["dateFilter","$timeout"],LoadCategory.$inject=["$rootScope","$http","$log"],DataCache.$inject=["$cacheFactory"],OrderProduct.$inject=["$rootScope","$http","$log"],LoadProducts.$inject=["$rootScope","$http","$log"],UserService.$inject=["$http"],DemoCtrl.$inject=["$timeout","$q","$log"],MainCtrl.$inject=["$rootScope","$log"],KassaAmountCtrl.$inject=["$rootScope","$scope","$element","$log","orderProductFactory"],KassaProductCategoryCtrl.$inject=["$rootScope","$scope","$http","$element","$log","loadProductsFactory","orderProductFactory"],CategoryCtrl.$inject=["$rootScope","$scope","$http","$log","loadCategoryFactory"],LoginCtrl.$inject=["$rootScope","$scope","$location","$log"],MenuCtrl.$inject=["$rootScope","$scope","$log","$route","$location"],KassaProductCtrl.$inject=["$rootScope","$scope","$http","$element","$log","orderProductFactory"],KassaSearchCtrl.$inject=["$rootScope","$log"],ToolbarCtrl.$inject=["$rootScope","$scope","$log","$route","$location"];