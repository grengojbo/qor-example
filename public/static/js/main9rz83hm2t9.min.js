"use strict";function Clock(dateFilter,$timeout){return{restrict:"E",scope:{format:"@"},link:function(scope,element,attrs){var updateTime=function(){var now=Date.now();element.html(dateFilter(now,scope.format)),$timeout(updateTime,now%1e3)};updateTime()}}}function LoadCategory($rootScope,$http,$log){function GetAll(){return $http.get(apiUrl+"/api/v1/category").then(handleSuccess,handleError("Error getting all category"))}function handleSuccess(res){return res.data.data}function handleError(error){return function(){return{success:!1,message:error}}}var apiUrl=$rootScope.Url,service={};return service.GetAll=GetAll,service}function DemoCtrl($timeout,$q,$log){function newState(state){}function querySearch(query){var deferred,results=query?self.states.filter(createFilterFor(query)):self.states;return self.simulateQuery?(deferred=$q.defer(),$timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise):results}function searchTextChange(text){$log.info("Text changed to "+text)}function selectedItemChange(item){$log.info("Item changed to "+JSON.stringify(item))}function loadAll(){var allStates="Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, Delaware,              Florida, Georgia, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana,              Maine, Maryland, Massachusetts, Michigan, Minnesota, Mississippi, Missouri, Montana,              Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, New York, North Carolina,              North Dakota, Ohio, Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina,              South Dakota, Tennessee, Texas, Utah, Vermont, Virginia, Washington, West Virginia,              Wisconsin, Wyoming";return allStates.split(/, +/g).map(function(state){return{value:state.toLowerCase(),display:state}})}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(state){return 0===state.value.indexOf(lowercaseQuery)}}var self=this;self.simulateQuery=!1,self.isDisabled=!1,self.states=loadAll(),self.querySearch=querySearch,self.selectedItemChange=selectedItemChange,self.searchTextChange=searchTextChange,self.newState=newState}function MainCtrl($rootScope,$log){function productCalc(){var amount=0;angular.forEach($rootScope.products,function(val,key){var curAmount=0;curAmount=val.price*val.count,amount+=curAmount,curAmount!=val.amount&&$log.error("curAmount: "+curAmount+" != val.amount: "+val.amount)}),$log.debug("amount:"+amount),$rootScope.orderAmount=amount}var self=this;self.productCalc=productCalc,$rootScope.globalLoader=!0,$rootScope.Url="http://k.bbox.kiev.ua",$rootScope.CurrentCategory=0,$rootScope.user={},$rootScope.user.id=3,$rootScope.user.name="Вейдер Д. А.",$rootScope.OrderCode="XXX-XXXXXXX",$rootScope.products=[],$rootScope.prod=[],$rootScope.orderAmount=0,$rootScope.$on("rootScope.summa",function(){$log.debug("MainCtrl - on - rootScope.summa"),self.productCalc()})}function KassaAmountCtrl($rootScope,$scope,$element,$log){function cleanOrder(){$log.debug("------ cleanOrder -----"),$rootScope.CurrentCategory=0,$rootScope.products.length=0,$rootScope.prod.length=0,$rootScope.orderAmount=0,$scope.clientAmmount=null,self.model.clientAmmount=0,self.model.clientSurrender=0}function Surrender(){var res=0;return self.model.clientAmmount>0&&(res=self.model.clientAmmount-self.model.amount),$log.info("Surrender="+res),res}var self=this;self.isDisabled=!1,self.model={},self.model.code=$rootScope.OrderCode,self.model.clientAmmount=0,self.model.clientSurrender=0,self.model.amount=0,self.cleanOrder=cleanOrder,$scope.clientAmmount=null,$scope.$watch("clientAmmount",function(){$log.debug("$watch -------> model.clientAmmount"),self.model.clientAmmount=$scope.clientAmmount,self.model.clientSurrender=Surrender()}),$rootScope.$watch("orderAmount",function(){$log.debug("$watch -------> orderAmount"),self.model.amount=$rootScope.orderAmount,self.model.clientSurrender=Surrender()})}function KassaProductCategoryCtrl($rootScope,$scope,$http,$element,$log,loadProductsFactory){function goPriv(){$scope.lim=$scope.data.nav.priv,$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)}function goNext(){$scope.lim=$scope.data.nav.next,$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)}function newState(item){$rootScope.products.push(item),$rootScope.$emit("rootScope.summa")}var self=this;self.isDisabled=!1,$scope.newState=newState,$scope.goPriv=goPriv,$scope.goNext=goNext,$scope.lim="",$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim),$rootScope.$on("rootScope.emit",function(){$log.info("KassaProductCategoryCtrl - rootScope.CurrentCategory"),$scope.lim="",$scope.data=loadProductsFactory.get($rootScope.CurrentCategory,$scope.lim)})}function CategoryCtrl($rootScope,$scope,$http,$log,loadCategoryFactory){function newState(id){id!==self.current?($rootScope.CurrentCategory=id,self.current=id):($rootScope.CurrentCategory=0,self.current=0),$rootScope.$emit("rootScope.emit")}var self=this;self.isDisabled=!1,self.newState=newState,self.current=0,self.items=[],loadCategoryFactory.GetAll().then(function(city){self.items=city})}function KassaProductCtrl($rootScope,$scope,$http,$element,$log){function removeItem(id){$rootScope.products.splice(id,1),$rootScope.$emit("rootScope.summa"),$log.info("remove ID:"+id)}function newState(id){$rootScope.CurrentCategory=id,$rootScope.$emit("rootScope.emit"),$log.info("Click category ID:"+$rootScope.CurrentCategory)}var self=this;self.isDisabled=!1,self.newState=newState,self.removeItem=removeItem,$scope.items=$rootScope.products}function KassaSearchCtrl($rootScope,$log){}var app=angular.module("MyApp",["ngMaterial","ngMessages"]);app.config(function($interpolateProvider){$interpolateProvider.startSymbol("{[{").endSymbol("}]}")}),app.controller("MainCtrl",MainCtrl),app.controller("CategoryCtrl",CategoryCtrl),app.controller("KassaProductCategoryCtrl",KassaProductCategoryCtrl),app.controller("KassaSearchCtrl",KassaSearchCtrl),app.controller("KassaProductCtrl",KassaProductCtrl),app.controller("KassaAmountCtrl",KassaAmountCtrl),app.directive("clock",Clock),app.factory("loadCategoryFactory",LoadCategory),app.factory("loadProductsFactory",["$rootScope","$http","$log",function($rootScope,$http,$log){var apiUrl=$rootScope.Url,url=null,obj={nav:{count:null,page:null,current:null,total:null,next:null,priv:null,isNext:!0,isPriv:!0},items:[],category:null};return{get:function(category_id,page){return void 0===category_id&&(category_id=0),obj.category=category_id,void 0===page&&(page="?limit=18"),url=obj.category>0?apiUrl+"/api/v1/category/"+obj.category+"/products":apiUrl+"/api/v1/products",0===page.length&&(page="?limit=18"),$http.get(url+page).success(function(data){obj.items=data.data,obj.nav.count=data.count,obj.nav.current=data.current,obj.nav.total=data.total,obj.nav.page=data.current+"/"+data.total,obj.nav.next=data.next,obj.nav.priv=data.priv,data.priv.length>0?obj.nav.isPriv=!1:obj.nav.isPriv=!0,data.next.length>0?obj.nav.isNext=!1:obj.nav.isNext=!0}),obj}}}]),Clock.$inject=["dateFilter","$timeout"],LoadCategory.$inject=["$rootScope","$http","$log"],DemoCtrl.$inject=["$timeout","$q","$log"],MainCtrl.$inject=["$rootScope","$log"],KassaAmountCtrl.$inject=["$rootScope","$scope","$element","$log"],KassaProductCategoryCtrl.$inject=["$rootScope","$scope","$http","$element","$log","loadProductsFactory"],CategoryCtrl.$inject=["$rootScope","$scope","$http","$log","loadCategoryFactory"],KassaProductCtrl.$inject=["$rootScope","$scope","$http","$element","$log"],KassaSearchCtrl.$inject=["$rootScope","$log"];