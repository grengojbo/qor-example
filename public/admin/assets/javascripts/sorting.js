!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function o(i,n){this.$element=t(i),this.options=t.extend({},o.DEFAULTS,t.isPlainObject(n)&&n),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}var i=window.location,n="qor.sorting",e="enable."+n,r="disable."+n,s="change."+n,a="mousedown."+n,u="mouseup."+n,d="dragstart."+n,p="dragover."+n,f="drop."+n,h="qor-sorting",c="qor-sorting__highlight",l="tbody > tr";return o.prototype={constructor:o,init:function(){var i,n=this.options,e=this.$element,r=e.find(l),s=0,a=0,u=0;t("body").addClass(h),e.find("tbody .qor-table__actions").append(o.TEMPLATE),r.each(function(o){var e=t(this).find(n.input).data("position");o>0&&(e>i?a++:a--),i=e,u=o}),a===u?s=1:-a===u&&(s=-1),this.$rows=r,this.orderType=s,this.bind()},bind:function(){var o=this.options;this.$element.on(s,o.input,t.proxy(this.change,this)).on(a,o.toggle,t.proxy(this.mousedown,this)).on(u,t.proxy(this.mouseup,this)).on(d,l,t.proxy(this.dragstart,this)).on(p,l,t.proxy(this.dragover,this)).on(f,l,t.proxy(this.drop,this))},unbind:function(){this.$element.off(s,this.change).off(a,this.mousedown)},change:function(o){var i,n=this.options,e=this.orderType,r=this.$rows,s=t(o.currentTarget),a=s.closest("tr"),u=a.parent(),d=s.data(),p=d.position,f=parseInt(s.val(),10),h=f>p;r.each(function(){var o=t(this),r=o.find(n.input),s=r.data("position");s===f&&(i=o,h?1===e?i.after(a):-1===e&&i.before(a):1===e?i.before(a):-1===e&&i.after(a)),h?s>p&&f>=s&&r.data("position",--s).val(s):p>s&&s>=f&&r.data("position",++s).val(s)}),s.data("position",f),i||(h?1===e?u.append(a):-1===e&&u.prepend(a):1===e?u.prepend(a):-1===e&&u.append(a)),this.sort(a,{url:d.sortingUrl,from:p,to:f})},mousedown:function(o){this.startY=o.pageY,t(o.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(l).prop("draggable",!1)},dragstart:function(o){var i=o.originalEvent,n=t(o.currentTarget);n.prop("draggable")&&i.dataTransfer&&(i.dataTransfer.effectAllowed="move",this.$source=n)},dragover:function(t){var o=this.$source;o&&t.currentTarget!==this.$source[0]&&t.preventDefault()},drop:function(o){var i,n,e,r,s,a,u=this.options,d=this.orderType,p=o.pageY>this.startY,f=this.$source;f&&o.currentTarget!==this.$source[0]&&(o.preventDefault(),n=t(o.currentTarget),i=f.find(u.input),e=i.data(),r=e.position,s=n.find(u.input).data("position"),a=s>r,this.$element.find(l).each(function(){var o=t(this).find(u.input),i=o.data("position");a?i>r&&s>=i&&o.data("position",--i).val(i):r>i&&i>=s&&o.data("position",++i).val(i)}),i.data("position",s).val(s),a?1===d?n.after(f):-1===d?n.before(f):p?n.after(f):n.before(f):1===d?n.before(f):-1===d?n.after(f):p?n.before(f):n.after(f),this.sort(f,{url:e.sortingUrl,from:r,to:s}))},sort:function(o,n){var e=this.options;n.url&&(this.highlight(o),t.ajax(n.url,{method:"post",data:{from:n.from,to:n.to},success:function(t,i,n){200===n.status&&o.find(e.input).data("position",t).val(t)},error:function(t,o,n){422===t.status?window.confirm(t.responseText)&&i.reload():window.confirm([o,n].join(": "))&&i.reload()}}))},highlight:function(t){t.addClass(c),setTimeout(function(){t.removeClass(c)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(n)}},o.DEFAULTS={toggle:!1,input:!1},o.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">swap_vert</i></a>',o.plugin=function(i){return this.each(function(){var e,r=t(this),s=r.data(n);if(!s){if(/destroy/.test(i))return;r.data(n,s=new o(this,i))}"string"==typeof i&&t.isFunction(e=s[i])&&e.apply(s)})},t(function(){if(/sorting\=true/.test(i.search)){var n=".qor-js-table",s={toggle:".qor-sorting__toggle",input:".qor-sorting__position"};t(document).on(r,function(i){o.plugin.call(t(n,i.target),"destroy")}).on(e,function(i){o.plugin.call(t(n,i.target),s)}).trigger("disable.qor.slideout").triggerHandler(e)}}),o});